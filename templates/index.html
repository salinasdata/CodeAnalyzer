<!DOCTYPE html>

<html lang="en" class="dark">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>{{context.title}}</title>
</head>

<body class="dark:bg-gray-900">
<div class="flex items-center py-2 px-3">
    <h1 class="text-3xl text-slate-300">{{context.title}}</h1>
</div>
<br/>
<div class="flex items-center py-2 px-3">
    <div class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
        <form id="message-form" action="" onsubmit="sendMessage(event)">
            <label for="github_repo_id">GitHub public repository URL or large text input to analyze: </label>
            <textarea class="flex justify-center block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border
            border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600
            dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                      type="text" id="github_repo_id" autocomplete="off" maxlength="10000"></textarea>
            <label for="openai_key_id">OpenAI secret key: </label>
            <input class="flex justify-center block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                   type="text" id="openai_key_id" autocomplete="off"/>
            <button>Submit</button>
        </form>
    </div>
</div>

<div class="flex items-center py-2 px-3">
    <h2
            class="text-2xl text-slate-400 overline decoration-4 decoration-pink-500"
    >
        {{context.log_file}}
    </h2>
</div>

<div class="flex items-center py-2 px-3">
    <div
            id="logs"
            class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
    >
    </div>
</div>

<script>
    var ws_log = new WebSocket("ws://{{context.host_url}}/ws/");
    var form = document.getElementById('message-form');
    ws_log.onmessage = function (event) {
        var logs = document.getElementById("logs");
        var log_data = event.data;
        logs.innerHTML += "<div>" + log_data + "</div>";
    };

    form.onsubmit = function (e) {
        e.preventDefault();
        var github_repo_id = document.getElementById("github_repo_id");
        var openai_key_id = document.getElementById("openai_key_id");
        var params = {
            github_repo: github_repo_id.value,
            openai_key: openai_key_id.value
        }
        console.log(JSON.stringify(params) )
        ws_log.send(JSON.stringify(params));
        logs.innerHTML = "";
        return false;
    };

</script>
</body>
</html>